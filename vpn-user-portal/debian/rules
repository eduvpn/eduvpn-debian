#!/usr/bin/make -f

define REQUIRES
require_once '/usr/share/php/fkooman/Jwt/autoload.php';
require_once '/usr/share/php/fkooman/OAuth/Server/autoload.php';
require_once '/usr/share/php/fkooman/SeCookie/autoload.php';
require_once '/usr/share/php/fkooman/SqliteMigrate/autoload.php';
require_once '/usr/share/php/LC/Common/autoload.php';
require_once '/usr/share/php/ParagonIE/ConstantTime/autoload.php';
require_once __DIR__.'/sodium_compat.php';
if (is_file('/usr/share/php/fkooman/SAML/SP/autoload.php') && is_readable('/usr/share/php/fkooman/SAML/SP/autoload.php')) {
    require_once '/usr/share/php/fkooman/SAML/SP/autoload.php';
}
endef

# easier to use this as a shell variable
export REQUIRES

override_dh_auto_build:
	# add hashbang to scripts to make the executable
	sed -i '1s/^/#!\/usr\/bin\/php\n/' bin/*.php

	phpab -o src/autoload.php src
	echo "$${REQUIRES}" >> src/autoload.php

override_dh_auto_test:
	phpab -o tests/autoload.php tests
	echo "require_once 'src/autoload.php';" >> tests/autoload.php
	phpunit --bootstrap=tests/autoload.php

%:
	dh $@ --with phpcomposer
